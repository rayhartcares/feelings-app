<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Brave Feelings Lab â€“ ANGRY (Emoji Version)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    :root {
      --bg: #e0f2fe;
      --shell: #ffffff;
      --shell-radius: 32px;
      --accent-red: #ef4444;
      --accent-red-dark: #b91c1c;
      --accent-green: #22c55e;
      --accent-purple: #a855f7;
      --gray-100: #f3f4f6;
      --gray-300: #d1d5db;
      --gray-600: #4b5563;
      --gray-800: #1f2933;
    }
    body {
      margin: 0;
      padding: 16px;
      font-family: 'Nunito', system-ui, sans-serif;
      background: var(--bg);
      color: var(--gray-800);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .phone-shell {
      width: 100%;
      max-width: 420px;
      max-height: 820px;
      background: var(--shell);
      border-radius: var(--shell-radius);
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.25);
      border: 10px solid #fff;
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .phone-header {
      padding: 10px 14px;
      background: var(--gray-100);
      border-bottom: 1px solid var(--gray-300);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #9ca3af;
      font-weight: 700;
    }
    .phone-header span.title {
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .phone-main {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    /* Generic layout helpers */
    .screen {
      height: 100%;
      display: flex;
      flex-direction: column;
      text-align: center;
      animation: fadeIn 0.35s ease-out;
    }
    .screen h1, .screen h2 {
      margin: 0;
    }
    .spacer { height: 16px; }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-weight: 800;
      cursor: pointer;
      font-size: 1rem;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease, border-color 0.12s ease;
    }
    .btn-primary {
      background: var(--accent-red);
      color: #fff;
      box-shadow: 0 8px 18px rgba(239, 68, 68, 0.4);
      border-bottom: 4px solid var(--accent-red-dark);
    }
    .btn-primary:hover {
      background: #f97373;
      transform: translateY(-1px);
    }
    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(239, 68, 68, 0.4);
      border-bottom-width: 0;
    }
    .btn-gray {
      background: var(--gray-100);
      color: var(--gray-800);
      border: 1px solid var(--gray-300);
    }
    .btn-gray:hover {
      background: #e5e7eb;
      transform: translateY(-1px);
    }
    .btn-green {
      background: var(--accent-green);
      color: #fff;
      box-shadow: 0 6px 14px rgba(34, 197, 94, 0.4);
    }
    .btn-green:hover {
      background: #4ade80;
      transform: translateY(-1px);
    }
    .btn-purple {
      background: var(--accent-purple);
      color: #fff;
      box-shadow: 0 6px 14px rgba(168, 85, 247, 0.4);
    }
    .btn-purple:hover {
      background: #c084fc;
      transform: translateY(-1px);
    }
    .btn-full {
      width: 100%;
      justify-content: center;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .emoji-big {
      font-size: 4.5rem;
    }
    .emoji-huge {
      font-size: 5rem;
    }
    .card {
      background: #fff;
      border-radius: 22px;
      padding: 16px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.09);
      border: 1px solid #e5e7eb;
    }

    .pill-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }
    .pill {
      flex: 1;
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      font-size: 0.9rem;
      color: var(--gray-600);
      background: #f9fafb;
    }

    /* Tabs */
    .tab-bar {
      display: flex;
      background: #e5e7eb;
      padding: 4px;
      border-radius: 999px;
      margin-bottom: 12px;
    }
    .tab-btn {
      flex: 1;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 0.85rem;
      font-weight: 700;
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--gray-600);
    }
    .tab-btn.active {
      background: #fff;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
      color: var(--accent-red);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .tile {
      border-radius: 18px;
      padding: 10px;
      background: #fee2e2;
      border: 2px solid #fecaca;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }
    .tile.green {
      background: #dcfce7;
      border-color: #bbf7d0;
    }
    .tile span.emoji {
      font-size: 2.2rem;
      margin-bottom: 4px;
    }
    .tile span.label {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--gray-800);
    }
    .tile:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.16);
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 16px;
    }

    .text-bubble {
      border-radius: 18px;
      padding: 12px 14px;
      background: #fef9c3;
      border: 1px solid #facc15;
      font-size: 0.98rem;
      color: var(--gray-800);
    }

    .footer-actions {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Small helper classes */
    .mt-8 { margin-top: 32px; }
    .mt-4 { margin-top: 16px; }
    .mt-2 { margin-top: 8px; }
    .mb-4 { margin-bottom: 16px; }
    .text-sm { font-size: 0.85rem; }
    .text-lg { font-size: 1.1rem; }
    .font-bold { font-weight: 700; }
    .font-black { font-weight: 900; }
    .text-gray { color: var(--gray-600); }
    .text-red { color: var(--accent-red); }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #fee2e2;
      color: #991b1b;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.8rem;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="phone-shell">
    <div class="phone-header">
      <span class="title">Brave Feelings Lab</span>
      <span id="header-character"></span>
    </div>
    <div class="phone-main">
      <div id="app"></div>
    </div>
  </div>

  <script>
    // === STATE ===
    const state = {
      view: 'welcome',    // 'welcome' | 'character' | 'trigger' | 'menu' | 'negative_x' | 'tool' | 'reflection' | 'restart'
      character: 'boy',   // 'boy' | 'girl'
      tab: 'negative',    // 'negative' | 'coping'
      toolKey: null,      // 'balloon' | 'squeeze' | 'walk' | 'talk'
      toolStep: 1         // 1..3
    };

    const app = document.getElementById('app');
    const headerCharacter = document.getElementById('header-character');

    // === DATA ===
    const negativeReactions = {
      throw: {
        emojiScene: 'ðŸ§¸ðŸ’¥',
        title: 'Throwing Things',
        desc: 'Oh no! Throwing toys makes a big mess and might break something special.'
      },
      yell: {
        emojiScene: 'ðŸ—£ï¸ðŸ˜«',
        title: 'Yelling Loudly',
        desc: 'Yelling hurts people\'s ears and makes them feel sad or scared.'
      },
      meltdown: {
        emojiScene: 'ðŸŒŠðŸ˜­',
        title: 'Meltdown on the Floor',
        desc: 'Crying on the floor makes it hard to use your words to fix the problem.'
      },
      walkaway: {
        emojiScene: 'ðŸšªðŸ˜¤',
        title: 'Stomping Away',
        desc: 'Running away doesn\'t fix the problem. The problem is still there when you come back.'
      }
    };

    const copingTools = {
      balloon: {
        name: 'Balloon Breathing',
        steps: [
          { emoji: 'ðŸŽˆðŸ˜¤', text: 'Imagine a balloon in your tummy. Take a big breath in through your nose to fill it up.' },
          { emoji: 'âœ‹â±ï¸', text: 'Hold that breath for 3 seconds. 1... 2... 3...' },
          { emoji: 'ðŸŒ¬ï¸ðŸ’¨', text: 'Now let the air out slowly through your mouth. Whooooosh.' }
        ]
      },
      squeeze: {
        name: 'Stress Squeeze',
        steps: [
          { emoji: 'ðŸ§¸âœŠ', text: 'Find a soft toy, pillow, or just clasp your hands together.' },
          { emoji: 'ðŸ’ªðŸ˜£', text: 'Squeeze your muscles TIGHT and count to 5.' },
          { emoji: 'ðŸ˜ŒðŸ', text: 'Let go and relax your body, like a cooked noodle.' }
        ]
      },
      walk: {
        name: 'Safe Walk',
        steps: [
          { emoji: 'ðŸ›‘ðŸ‘€', text: 'Stop what you are doing, and look for a safe place.' },
          { emoji: 'ðŸš¶â€â™‚ï¸ðŸŒ³', text: 'Walk slowly to your safe spot or near a window.' },
          { emoji: 'ðŸ‘€ðŸŸ¦ðŸŸ©', text: 'Find 3 things that are blue or green. Look at them and breathe slowly.' }
        ]
      },
      talk: {
        name: 'Talk to a Grown-Up',
        steps: [
          { emoji: 'ðŸ™‹â€â™€ï¸ðŸ‘¨â€ðŸ‘©â€ðŸ§‘', text: 'Find a grown-up you trust.' },
          { emoji: 'ðŸ—£ï¸ðŸ’¬', text: 'Use your words: â€œI feel angry becauseâ€¦â€' },
          { emoji: 'ðŸ‘‚ðŸ¤', text: 'Listen to their help. You can fix it together.' }
        ]
      }
    };

    function getCharacterFace() {
      return state.character === 'boy' ? 'ðŸ‘¦' : 'ðŸ‘§';
    }
    function getAngryFace() {
      return state.character === 'boy' ? 'ðŸ˜¡' : 'ðŸ˜ ';
    }

    // === HELPERS ===
    function clearApp() {
      app.innerHTML = '';
    }

    function el(tag, className = '', text = '') {
      const e = document.createElement(tag);
      if (className) e.className = className;
      if (text) e.textContent = text;
      return e;
    }

    function render() {
      clearApp();

      // header avatar
      headerCharacter.textContent = state.view === 'welcome' ? '' : getCharacterFace();

      switch (state.view) {
        case 'welcome':
          renderWelcome();
          break;
        case 'character':
          renderCharacter();
          break;
        case 'trigger':
          renderTrigger();
          break;
        case 'menu':
          renderMenu();
          break;
        case 'tool':
          renderTool();
          break;
        case 'reflection':
          renderReflection();
          break;
        case 'restart':
          renderRestart();
          break;
        default:
          if (state.view.startsWith('negative_')) {
            const key = state.view.replace('negative_', '');
            renderNegative(key);
          }
      }
    }

    // === SCREENS ===

    function renderWelcome() {
      const screen = el('div', 'screen');

      const titleBlock = el('div');
      const h1 = el('h1', 'font-black text-red', 'Brave Feelings Lab');
      h1.style.fontSize = '1.9rem';
      const h2 = el('h2', 'font-bold text-gray', 'Emotion Navigator â€“ ANGRY');
      h2.style.fontSize = '1.2rem';
      titleBlock.appendChild(h1);
      titleBlock.appendChild(h2);

      const emoji = el('div', 'emoji-huge mt-8', getAngryFace());
      emoji.style.animation = 'bounce 1.2s infinite';

      const btnStart = el('button', 'btn btn-primary mt-8', 'START');
      btnStart.onclick = () => {
        state.view = 'character';
        render();
      };

      screen.appendChild(titleBlock);
      screen.appendChild(emoji);
      screen.appendChild(btnStart);
      app.appendChild(screen);
    }

    function renderCharacter() {
      const screen = el('div', 'screen');

      const h2 = el('h2', 'font-bold', 'Who is playing today?');
      h2.style.fontSize = '1.4rem';
      h2.style.marginBottom = '12px';

      const row = el('div');
      row.style.display = 'flex';
      row.style.justifyContent = 'center';
      row.style.gap = '12px';
      row.style.marginTop = '8px';

      function characterCard(label, charKey, bgColor, borderColor) {
        const card = el('div', 'card');
        card.style.background = bgColor;
        card.style.borderColor = borderColor;
        card.style.flex = '1';
        card.style.cursor = 'pointer';

        const emoji = el('div', 'emoji-big', charKey === 'boy' ? 'ðŸ‘¦' : 'ðŸ‘§');
        const name = el('div', 'mt-2 font-bold', charKey === 'boy' ? 'Boy' : 'Girl');
        const btn = el('button', 'btn btn-full btn-gray mt-2', `Use ${label}`);

        btn.onclick = () => {
          state.character = charKey;
          state.view = 'trigger';
          render();
        };

        card.appendChild(emoji);
        card.appendChild(name);
        card.appendChild(btn);
        return card;
      }

      row.appendChild(characterCard('Boy', 'boy', '#dbeafe', '#bfdbfe'));
      row.appendChild(characterCard('Girl', 'girl', '#ffe4e6', '#fecdd3'));

      const tip = el('p', 'text-sm text-gray mt-4',
        'You can always come back later and choose a different character.');

      screen.appendChild(h2);
      screen.appendChild(row);
      screen.appendChild(tip);
      app.appendChild(screen);
    }

    function renderTrigger() {
      const screen = el('div', 'screen');

      const h2 = el('h2', 'font-bold', 'Uh-oh! Something happened!');
      h2.style.fontSize = '1.3rem';

      const cardScene = el('div', 'card mt-4');
      const emoji = el('div', 'emoji-big', 'ðŸ§¸âž¡ï¸ðŸ’”');
      const flash = el('div', 'emoji-big', 'âš¡');
      flash.style.opacity = '0.2';
      flash.style.marginTop = '4px';
      cardScene.appendChild(emoji);
      cardScene.appendChild(flash);

      const bubble = el('div', 'text-bubble mt-4',
        'You were playing with your favorite toy and it suddenly broke. Your chest feels hot. Your face feels tight. You are ANGRY.');

      const buttons = el('div', 'footer-actions');
      const btnBack = el('button', 'btn btn-gray btn-full', 'Back');
      btnBack.onclick = () => {
        state.view = 'character';
        render();
      };
      const btnNext = el('button', 'btn btn-primary btn-full', 'Next: What will you do?');
      btnNext.onclick = () => {
        state.view = 'menu';
        render();
      };

      buttons.appendChild(btnBack);
      buttons.appendChild(btnNext);

      screen.appendChild(h2);
      screen.appendChild(cardScene);
      screen.appendChild(bubble);
      screen.appendChild(buttons);
      app.appendChild(screen);
    }

    function renderMenu() {
      const screen = el('div', 'screen');

      const header = el('div');
      const h2 = el('h2', 'font-bold', 'What will you do?');
      h2.style.fontSize = '1.3rem';
      const p = el('p', 'text-sm text-gray mt-2', 'Tap a button to see what happens.');
      header.appendChild(h2);
      header.appendChild(p);

      const tabs = el('div', 'tab-bar mt-4');
      const btnNeg = el('button', 'tab-btn' + (state.tab === 'negative' ? ' active' : ''), 'Negative reactions');
      const btnPos = el('button', 'tab-btn' + (state.tab === 'coping' ? ' active' : ''), 'Coping tools');
      btnNeg.onclick = () => { state.tab = 'negative'; render(); };
      btnPos.onclick = () => { state.tab = 'coping'; render(); };
      tabs.appendChild(btnNeg);
      tabs.appendChild(btnPos);

      const grid = el('div', 'grid-2');

      if (state.tab === 'negative') {
        function tile(key, emoji, label) {
          const t = el('div', 'tile');
          const e = el('span', 'emoji', emoji);
          const l = el('span', 'label', label);
          t.appendChild(e);
          t.appendChild(l);
          t.onclick = () => {
            state.view = 'negative_' + key;
            render();
          };
          return t;
        }
        grid.appendChild(tile('throw', 'ðŸ’¥', 'Throw'));
        grid.appendChild(tile('yell', getAngryFace(), 'Yell'));
        grid.appendChild(tile('meltdown', 'ðŸ˜­', 'Meltdown'));
        grid.appendChild(tile('walkaway', 'ðŸ˜¤', 'Walk away'));
      } else {
        function tileTool(key, emoji, label) {
          const t = el('div', 'tile green');
          const e = el('span', 'emoji', emoji);
          const l = el('span', 'label', label);
          t.appendChild(e);
          t.appendChild(l);
          t.onclick = () => {
            state.toolKey = key;
            state.toolStep = 1;
            state.view = 'tool';
            render();
          };
          return t;
        }
        grid.appendChild(tileTool('balloon', 'ðŸŽˆ', 'Balloon breath'));
        grid.appendChild(tileTool('squeeze', 'ðŸ§¸', 'Stress squeeze'));
        grid.appendChild(tileTool('walk', 'ðŸš¶â€â™‚ï¸', 'Safe walk'));
        grid.appendChild(tileTool('talk', 'ðŸ‘©â€ðŸ«', 'Talk to adult'));
      }

      const footer = el('div', 'footer-actions mt-4');
      const backBtn = el('button', 'btn btn-gray btn-full', 'Back to scene');
      backBtn.onclick = () => {
        state.view = 'trigger';
        render();
      };
      footer.appendChild(backBtn);

      screen.appendChild(header);
      screen.appendChild(tabs);
      screen.appendChild(grid);
      screen.appendChild(footer);
      app.appendChild(screen);
    }

    function renderNegative(key) {
      const data = negativeReactions[key];
      const screen = el('div', 'screen');

      const h2 = el('h2', 'font-bold', data.title);
      h2.style.fontSize = '1.3rem';

      const card = el('div', 'card mt-4');
      card.style.background = '#fee2e2';
      card.style.borderColor = '#fecaca';
      const emojiScene = el('div', 'emoji-big', data.emojiScene);
      card.appendChild(emojiScene);

      const text = el('div', 'text-bubble mt-4', data.desc);

      const actions = el('div', 'stack');
      const btnTry = el('button', 'btn btn-gray btn-full', 'Try a different reaction');
      btnTry.onclick = () => {
        state.view = 'menu';
        state.tab = 'negative';
        render();
      };
      const btnGoCoping = el('button', 'btn btn-green btn-full', 'Go to coping tools âœ¨');
      btnGoCoping.onclick = () => {
        state.view = 'menu';
        state.tab = 'coping';
        render();
      };

      actions.appendChild(btnTry);
      actions.appendChild(btnGoCoping);

      screen.appendChild(h2);
      screen.appendChild(card);
      screen.appendChild(text);
      screen.appendChild(actions);
      app.appendChild(screen);
    }

    function renderTool() {
      const tool = copingTools[state.toolKey];
      const stepIndex = state.toolStep - 1;
      const step = tool.steps[stepIndex];

      const screen = el('div', 'screen');

      const topRow = el('div');
      topRow.style.display = 'flex';
      topRow.style.justifyContent = 'space-between';
      topRow.style.alignItems = 'center';

      const heading = el('h2', 'font-bold', tool.name);
      heading.style.fontSize = '1.1rem';
      heading.style.textAlign = 'left';

      const badge = el('div', 'badge', `Step ${state.toolStep} / 3`);

      topRow.appendChild(heading);
      topRow.appendChild(badge);

      const emoji = el('div', 'emoji-huge mt-4', step.emoji);
      const bubble = el('div', 'text-bubble mt-4', step.text);

      const footer = el('div', 'footer-actions');
      const btnRestart = el('button', 'btn btn-gray btn-full', 'Restart tool');
      btnRestart.onclick = () => {
        state.toolStep = 1;
        render();
      };

      const btnNext = el('button', 'btn btn-green btn-full',
        state.toolStep === 3 ? 'Finish!' : 'Next step â†’');
      btnNext.onclick = () => {
        if (state.toolStep < 3) {
          state.toolStep += 1;
          render();
        } else {
          state.view = 'reflection';
          render();
        }
      };

      footer.appendChild(btnRestart);
      footer.appendChild(btnNext);

      screen.appendChild(topRow);
      screen.appendChild(emoji);
      screen.appendChild(bubble);
      screen.appendChild(footer);
      app.appendChild(screen);
    }

    function renderReflection() {
      const screen = el('div', 'screen');

      const h2 = el('h2', 'font-black text-red', 'Great job!');
      h2.style.fontSize = '1.6rem';

      const faceWrap = el('div', 'mt-4');
      const face = el('div', 'emoji-huge', 'ðŸ˜Š');
      const star = el('div', 'emoji-big', 'âœ¨');
      star.style.marginTop = '4px';
      faceWrap.appendChild(face);
      faceWrap.appendChild(star);

      const bubble = el('div', 'text-bubble mt-4',
        'You felt angry, but you used a coping tool to calm your body. Now your brain is ready to think and play again.');

      const btn = el('button', 'btn btn-purple btn-full mt-4', 'Continue');
      btn.onclick = () => {
        state.view = 'restart';
        render();
      };

      screen.appendChild(h2);
      screen.appendChild(faceWrap);
      screen.appendChild(bubble);
      screen.appendChild(btn);
      app.appendChild(screen);
    }

    function renderRestart() {
      const screen = el('div', 'screen');

      const h2 = el('h2', 'font-bold', 'What would you like to do next?');
      h2.style.fontSize = '1.3rem';

      const actions = el('div', 'stack mt-4');
      const btnAgain = el('button', 'btn btn-primary btn-full', 'Restart ANGRY ' + getAngryFace());
      btnAgain.onclick = () => {
        state.view = 'welcome';
        state.character = 'boy';
        state.tab = 'negative';
        state.toolKey = null;
        state.toolStep = 1;
        render();
      };

      const btnChoose = el('button', 'btn btn-purple btn-full', 'Choose a different emotion (future)');
      btnChoose.onclick = () => {
        // For now: just restart
        state.view = 'welcome';
        render();
      };

      actions.appendChild(btnAgain);
      actions.appendChild(btnChoose);

      screen.appendChild(h2);
      screen.appendChild(actions);
      app.appendChild(screen);
    }

    // Start
    render();
  </script>
</body>
</html>
